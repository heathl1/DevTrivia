<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>DevTrivia – Game</title>

    <!-- This page shows the simple trivia game screen for my DevTrivia project. -->
    <!-- It will load one question from my Java server when the page finishes loading. -->
    <!-- I am keeping the layout very basic on purpose since this is an early prototype. -->
</head>

<body>
<!-- This is the title with a link back to the home page so I can navigate easily. -->
<h1><a href="index.html">DevTrivia</a></h1>

<!-- This container is where I will inject the question, choices, and a result message. -->
<div id="app"><p>Loading question...</p></div>

<!-- This script contains the logic that fetches the question and handles user interaction. -->
<script>
    // I am waiting for the DOM to be fully loaded before I run any of my code.
    document.addEventListener('DOMContentLoaded', async () => {
        // This references the main content area where I will display the question and choices.
        const root = document.getElementById('app');

        try {
            // I am requesting JSON data from the server endpoint that returns trivia questions.
            // Because I used a relative path (/api/questions), it will call the same host and port that served this page.
            const res = await fetch('/api/questions');

            // If the server response is not OK (like 404 or 500), I will throw an error to handle below.
            if (!res.ok) throw new Error('HTTP ' + res.status);

            // I am converting the response body into a JavaScript array of questions.
            const questions = await res.json();

            // For this demo, I will use the first question in the array.
            const q = questions[0];


            // I am replacing the loading message with the question UI.
            // It includes the question text, a list of choices with radio buttons, a submit button, and a result area.

            root.innerHTML = `
        <h2>${q.question_text}</h2>
        <ol id="choices"></ol>
        <button id="submit" disabled>Submit</button>
        <p id="result"></p>
      `;



            // Here I am grabbing references to the choice list, the submit button, and the result paragraph.
            const choicesEl = document.getElementById('choices');
            const submit = document.getElementById('submit');
            const result = document.getElementById('result');

            // I am creating one list item per possible answer and adding a radio button for selection.
            q.choices.forEach((c, i) => {
                const li = document.createElement('li');
                li.innerHTML = `<label><input type="radio" name="ans" value="${i}"> ${c}</label>`;
                choicesEl.appendChild(li);
            });

            // Once any radio button is selected, I will enable the Submit button.
            choicesEl.addEventListener('change', () => { submit.disabled = false; });

            // When the user clicks Submit, I will check whether their selected index matches the correct answer index.
            submit.addEventListener('click', () => {
                // This finds whichever radio button is currently selected.
                const sel = document.querySelector('input[name="ans"]:checked');

                // I will convert the selected value (which is a string) into a number so I can compare it easily.
                const idx = parseInt(sel.value, 10);

                // If the chosen index is the same as the correct index, I will show a success message.
                // Otherwise, I will display which choice was actually correct.
                if (idx === q.answerIndex) {
                    result.textContent = "✅ Correct! Nice job.";
                } else {
                    result.textContent = `❌ Not quite. Correct answer: ${q.choices[q.answerIndex]}`;
                }

                // I am disabling the button so the user cannot submit multiple times for the same question.
                submit.disabled = true;
            });

        } catch (e) {
            // If anything goes wrong (for example, the server is not running), I will show an error message on the page.
            // This helps me diagnose problems without opening the browser console.
            root.innerHTML = `<p>Failed to load question: ${e}</p>
                        <p>Please make sure the server is running and try opening <code>/questions</code> directly.</p>`;
        }
    });
</script>
</body>
</html>